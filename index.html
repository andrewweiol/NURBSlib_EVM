<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>NURBSlib_EVM by edwardvmills</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>NURBSlib_EVM</h1>
        <p>python scripts and macros to make NURBS surfaces in FreeCAD -</p>

        <p class="view"><a href="https://github.com/edwardvmills/NURBSlib_EVM">View the Project on GitHub <small>edwardvmills/NURBSlib_EVM</small></a></p>


        <ul>
          <li><a href="https://github.com/edwardvmills/NURBSlib_EVM/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/edwardvmills/NURBSlib_EVM/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/edwardvmills/NURBSlib_EVM">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h2>
<a id="nurbslib_evm" class="anchor" href="#nurbslib_evm" aria-hidden="true"><span class="octicon octicon-link"></span></a>NURBSlib_EVM</h2>

<p>My python scripts for creating surfaces in <a href="http://freecadweb.org/">FreeCAD</a>.<br>
Extremely early release. Makes alphas look polished :)</p>

<p>I am not an expert in any of this. I am enjoying myself while re-inventing the wheel!</p>

<p><img src="https://github.com/edwardvmills/NURBSlib_EVM/blob/master/site_stuff/current_state/G2%20join%2066%20surfaces%2005.png?raw=true" alt="A semi decent G2 seam between two surfaces"><br>
[This image made with tools that are released, but not yet explained below]</p>

<p>At this time, none of the entities created by these scripts are parametric. 
This is the rough workflow prototyping phase. 
If/when the surface creation methods reach my minimum goals, i intend to make them parametric.</p>

<p>All scripts in this repository are offered under the terms of the 
<a href="http://www.gnu.org/licenses/gpl-3.0.en.html">GPLv3</a><br>
All models in this repository are offered under the terms of 
<a href="http://creativecommons.org/licenses/by/2.0/">CC-BY</a>   </p>

<p>For the time being, this page is intended to give a quick explanation of each tool along with pictures. 
You can read more about the project <a href="README.md">here</a></p>

<h3>
<a id="setup" class="anchor" href="#setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup</h3>

<p>There is a release, or you can grab from master.</p>

<p>-from <a href="https://github.com/edwardvmills/NURBSlib_EVM/tree/master/NURBSlib_EVM_python">NURBSlib_EVM_python</a>, take NURBSlib_EVM.py, all *.fcmacro files<br>
-grab the <a href="https://github.com/edwardvmills/NURBSlib_EVM/tree/master/icons">icons</a><br>
-put them somewhere FreeCAD can find them<br>
-link the fcmacro scripts to icons, descriptions(use macro name), tooltips (use macro name), etc.<br>
-put all those GUI macros in toolbars.<br>
-add those toolbars to the PartDesign workbench. The raw material will be PartDesign sketches, so this is a good place to put the toolbars for the time being.   </p>

<p>Here is a picture of how i like to group them:
<img src="https://github.com/edwardvmills/NURBSlib_EVM/blob/master/site_stuff/basic_usage/setting%20up%20the%20toolbars.png?raw=true" alt="toolbar setup"></p>

<h3>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h3>

<p><strong>Draw sketches of lines/circles</strong> (check each curve macro to see what inputs it wants). </p>

<p>In the picture below we see:<br>
-a sketcher arc<br>
-a sketch of three lines connected end to end<br>
-three 'node' sketches. A node is one circle + any number of lines that start at the circle center. I have big plans for these little nodes...curvature data...derivative of curvature data...topology data!
<img src="https://github.com/edwardvmills/NURBSlib_EVM/blob/master/site_stuff/basic_usage/_01%20sketches%20as%20inputs.png?raw=true" alt="sketches as inputs"></p>

<p>Select those lines/circles <em>in the order specified by the macro</em>, then hit the macro button. A curve is created.
In the picture below:<br>
-select the arc, then hit<br>
<img src="https://github.com/edwardvmills/NURBSlib_EVM/blob/master/icons/icon_bitmaps/Arc_to_rational_bezier.png?raw=true" alt="Arc_to_rational_bezier"><br>
This converts a sketch arc to a <strong>cubic</strong> <strong>rational</strong> bezier curve, formulated from a full NURBS.<br>
-select the three lines from the single sketch in order, then hit<br>
<img src="https://github.com/edwardvmills/NURBSlib_EVM/blob/master/icons/icon_bitmaps/Bezier_Cubic_3_lines.png?raw=true" alt="Bezier_Cubic_3_lines"><br>
This creates a cubic bezier curve, formulated from a full NURBS. The weights are all 1, so it's not rational <em>in practice</em>, but the weights are there, and in the future, we may modify them.<br>
-from one node, select the circle, then the line end point, then another node, select a line endpoint, then the circle. hit<br>
<img src="https://github.com/edwardvmills/NURBSlib_EVM/blob/master/icons/icon_bitmaps/Bezier_Cubic_2_nodes.png?raw=true" alt="Bezier_Cubic_2_nodes"><br>
Same type of curve as above.   </p>

<p>Why the funky selection order with nodes? The circles represent curve endpoints, and the lines radiating from them represent the tangents. The multiple lines give hints as to the intended topology. This is a 3D bezier control, and picking a circle is WAY easier than trying to explain to FreeCAD which point i want when there are many lines connecting at a point. [TODO, maybe: adapt the macro so the selection goes: circle&gt;line&gt;cirle&gt;line, extract the line endpoints, and reorder automatically)</p>

<p><img src="https://github.com/edwardvmills/NURBSlib_EVM/blob/master/site_stuff/basic_usage/_02%20curves%20from%20sketches.png?raw=true" alt="curves from sketches"><br>
The new arc is right on top of the sketch arc, so it looks funny.</p>

<p><strong>IMPORTANT NOTE ABOUT NURBS:</strong> the curves within a single surface 'patch' <em>cannot</em> be aligned at the corners! The corners <em>must</em> pinch at least a little bit. Otherwise, the surface may build, but the tangency controls will vanish. For my intentions, that makes the surface unusable.<br>
If you need to join two curves that are tangent where they meet, you need two surfaces. At least for now, for these scripts.</p>

<p><strong>Making surfaces from the curves</strong><br>
The surface macros need to be given 3 or 4 curves of the <em>same type</em> (degree, number of poles, knot vector). This is why we had to convert the arc.<br>
There are two types of surface right now:<br>
-rational bezier (accepts 3 or 4 cubic rational bezier curves)<br>
-6 pole by 6 pole NURBS (accepts 4 NURBS curves with 6 control points and a specific knot vector)</p>

<p>First, lets stay with bezier (icons are mostly red)</p>

<p>Select 3/4 curves in a loop counterclockwise (surface normal will then point towards you), hit<br>
<img src="https://github.com/edwardvmills/NURBSlib_EVM/blob/master/icons/icon_bitmaps/Bezier_cubic_4_sided_surface.png?raw=true" alt="Bezier_cubic_4_sided_surface"><br>
This takes a while. Expect FreeCAD to lock up for a bit. Adjust your tesselation in Preferences&gt;Part design&gt; Shape view until you have a balance of speed and surface resolution. If a single surface by itself looks rough, you need finer tesselation. I have no control over this, it's all FreeCAD internal as far as i know.</p>

<p>This creates a rational bezier surface.<br>
<img src="https://github.com/edwardvmills/NURBSlib_EVM/blob/master/site_stuff/basic_usage/_04%20surfaces%20from%20curves.png?raw=true" alt="bezier surfaces from bezier curves"><br>
<img src="https://github.com/edwardvmills/NURBSlib_EVM/blob/master/site_stuff/basic_usage/_05%20surfaces%20from%20curves%2002.png?raw=true" alt="surface from curves, other side"> 
Note that the arc edge is still a <em>true arc</em>, so we should be able to make good FreeCAD shells that join this surface type to other FreeCAD surfaces.  </p>

<p>If you're not sure the curves are correct don't want to waste the time to generate the surface, you can preview the control grid. [warning, generates a bazillion lines in your object tree. SO organize your model and stick these lines in their own folder!]<br>
-select the curves the way you would for a surface, then hit<br>
<img src="https://github.com/edwardvmills/NURBSlib_EVM/blob/master/icons/Bezier_cubic_4_sided_grid.svg?raw=true" alt="Bezier_cubic_4_sided_grid"><br>
This generates the grid that will be used for the surface<br>
<img src="https://github.com/edwardvmills/NURBSlib_EVM/blob/master/site_stuff/basic_usage/_03%20control%20grid%20preview%20from%20curves.png?raw=true" alt="control grid preview"></p>

<p>Many times, a surface will look good when created, but when we set the display to shaded and hide the edge, the seam between two surfaces looks just absolutely awful. This is why G1 (tangency matching) is not enough. Using bezier curves/surfaces, direct G2 matching is obtained at the expense of tangent control, so that's just useless.
--link placeholder to talk about bezier and G2<br>
Even maintaining G1 is way harder than it <em>seems</em> it ought to be.
--link placeholder to go over the rules for curve making to obtain G1 across seams</p>

<p>Tutorials on the way:
-'growing' two surfaces on one side of a single surface: local refinement within a non singular NURBS topology</p>

<p>-the 6 point cubic NURBS. Now we can match curvature independently at each curve endpoint.
-the surface made from groups of 6 point cubic NURBS.
-the sketch placer tool</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/edwardvmills">edwardvmills</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>

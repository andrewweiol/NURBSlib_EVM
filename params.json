{
  "name": "NURBSlib_EVM",
  "tagline": "python scripts and macros to make NURBS surfaces in FreeCAD -",
  "body": "## NURBSlib_EVM\r\nMy python scripts for creating surfaces in [FreeCAD](http://freecadweb.org/).   \r\nExtremely early release. \r\n\r\n\r\n![A semi decent G2 seam between two surfaces](https://github.com/edwardvmills/NURBSlib_EVM/blob/master/development_FC_models/parametric/Bezier%20surface%20segment%20and%20blend/Bezier%20surface%20segment%20and%20blend%2021/Bezier%20surface%20segment%20and%20blend%2021.gif?raw=true)   \r\n\r\n(https://github.com/edwardvmills/NURBSlib_EVM/blob/master/development_FC_models/parametric/Bezier%20surface%20segment%20and%20blend/Bezier%20surface%20segment%20and%20blend%2018/1f7g55.gif?raw=true)\r\n\r\nTHIS PAGE IS OUT OF DATE (12-14-2016) I don't have time to update user instructions until i finish the next big development phase. If interested, please refer directly to the repository.\r\n\r\nAll scripts in this repository are offered under the terms of the \r\n[GPLv3](http://www.gnu.org/licenses/gpl-3.0.en.html)   \r\nAll models in this repository are offered under the terms of \r\n[CC-BY](http://creativecommons.org/licenses/by/2.0/)   \r\n\r\nFor the time being, this page is intended to give a quick explanation of each tool along with pictures. \r\nYou can read more about the project [here](README.md)\r\n###Setup\r\nThere is a release, or you can grab from master.\r\n\r\n-from [NURBSlib_EVM_python](https://github.com/edwardvmills/NURBSlib_EVM/tree/master/NURBSlib_EVM_python), take NURBSlib_EVM.py, all *.fcmacro files   \r\n-grab the [icons](https://github.com/edwardvmills/NURBSlib_EVM/tree/master/icons)   \r\n-put them somewhere FreeCAD can find them   \r\n-link the fcmacro scripts to icons, descriptions(use macro name), tooltips (use macro name), etc.   \r\n-put all those GUI macros in toolbars.   \r\n-add those toolbars to the PartDesign workbench. The raw material will be PartDesign sketches, so this is a good place to put the toolbars for the time being.   \r\n\r\nHere is a picture of how i like to group them:\r\n![toolbar setup](https://github.com/edwardvmills/NURBSlib_EVM/blob/master/site_stuff/basic_usage/setting%20up%20the%20toolbars.png?raw=true)\r\n###Usage\r\n**Draw sketches of lines/circles** (check each curve macro to see what inputs it wants). \r\n\r\nIn the picture below we see:  \r\n-a sketcher arc   \r\n-a sketch of three lines connected end to end   \r\n-three 'node' sketches. A node is one circle + any number of lines that start at the circle center. I have big plans for these little nodes...curvature data...derivative of curvature data...topology data!\r\n![sketches as inputs](https://github.com/edwardvmills/NURBSlib_EVM/blob/master/site_stuff/basic_usage/_01%20sketches%20as%20inputs.png?raw=true)\r\n\r\nSelect those lines/circles _in the order specified by the macro_, then hit the macro button. A curve is created.\r\nIn the picture below:   \r\n\r\n-select the arc, then hit   \r\n![Arc_to_rational_bezier](https://github.com/edwardvmills/NURBSlib_EVM/blob/master/icons/icon_bitmaps/Arc_to_rational_bezier.png?raw=true)   \r\nThis converts a sketch arc to a **cubic** **rational** bezier curve, formulated from a full NURBS.   \r\n\r\n-select the three lines from the single sketch in order, then hit   \r\n![Bezier_Cubic_3_lines](https://github.com/edwardvmills/NURBSlib_EVM/blob/master/icons/icon_bitmaps/Bezier_Cubic_3_lines.png?raw=true)    \r\nThis creates a cubic bezier curve, formulated from a full NURBS. The weights are all 1, so it's not rational _in practice_, but the weights are there, and in the future, we may modify them.   \r\n\r\n-from one node, select the circle, then the line end point, then _from another node_, select a line endpoint, then the circle. hit   \r\n![Bezier_Cubic_2_nodes](https://github.com/edwardvmills/NURBSlib_EVM/blob/master/icons/icon_bitmaps/Bezier_Cubic_2_nodes.png?raw=true)   \r\nSame type of curve as above.   \r\n\r\nWhy the funky selection order with nodes? The circles represent curve endpoints, and the lines radiating from them represent the tangents. The multiple lines give hints as to the intended topology. This is a 3D bezier control, and picking a circle is WAY easier than trying to explain to FreeCAD which point i want when there are many lines connecting at a point.   \r\n[TODO, maybe: adapt the macro so the selection goes: circle>line>cirle>line, extract the line endpoints, and reorder automatically)\r\n   \r\n![curves from sketches](https://github.com/edwardvmills/NURBSlib_EVM/blob/master/site_stuff/basic_usage/_02%20curves%20from%20sketches.png?raw=true)   \r\nThe new arc is right on top of the sketch arc, so it looks funny.\r\n\r\n**IMPORTANT NOTE ABOUT NURBS:** the curves within a single surface 'patch' _cannot_ be aligned at the corners! The corners _must_ pinch at least a little bit. Otherwise, the surface may build, but the tangency controls will vanish. For my intentions, that makes the surface unusable.   \r\nIf you need to join two curves that are tangent where they meet, you need two surfaces. At least for now, for these scripts.\r\n\r\n**Making surfaces from the curves**   \r\nThe surface macros need to be given 3 or 4 curves of the _same type_ (degree, number of poles, knot vector). This is why we had to convert the arc.  \r\n \r\nThere are two types of surface right now:   \r\n-rational bezier (accepts 3 or 4 cubic rational bezier curves)   \r\n-6 pole by 6 pole NURBS (accepts 4 NURBS curves with 6 control points and a specific knot vector)\r\n\r\nFirst, lets stay with bezier (icons are mostly red)\r\n\r\nSelect 3/4 curves in a loop counterclockwise (surface normal will then point towards you), and hit   \r\n![Bezier_cubic_4_sided_surface](https://github.com/edwardvmills/NURBSlib_EVM/blob/master/icons/icon_bitmaps/Bezier_cubic_4_sided_surface.png?raw=true)   \r\nAnd then wait...     \r\nThis takes a while. Expect FreeCAD to lock up for a bit. Adjust your tesselation in Preferences>Part design> Shape view until you have a balance of speed and surface resolution. If a single surface by itself looks rough, you need finer tesselation. I have no control over this, it's all FreeCAD internals as far as i know.\r\n\r\nThis creates a rational bezier surface.   \r\n![bezier surfaces from bezier curves](https://github.com/edwardvmills/NURBSlib_EVM/blob/master/site_stuff/basic_usage/_04%20surfaces%20from%20curves.png?raw=true)  \r\n![surface from curves, other side](https://github.com/edwardvmills/NURBSlib_EVM/blob/master/site_stuff/basic_usage/_05%20surfaces%20from%20curves%2002.png?raw=true) \r\nNote that the arc edge is still a _true arc_, so we should be able to make good FreeCAD shells that join this surface type to other FreeCAD surfaces.  \r\n\r\nIf you're not sure the curves are correct and don't want to waste the time to generate the surface, you can preview the control grid. [warning, generates a bazillion lines in your object tree. So organize your model tree and stick these lines in their own folder!]   \r\n\r\n-select the curves the way you would for a surface, then hit   \r\n![Bezier_cubic_4_sided_grid](https://github.com/edwardvmills/NURBSlib_EVM/blob/master/icons/icon_bitmaps/Bezier_cubic_4_sided_grid.png?raw=true)   \r\nThis generates the grid that will be used for the surface   \r\n\r\n![control grid preview](https://github.com/edwardvmills/NURBSlib_EVM/blob/master/site_stuff/basic_usage/_03%20control%20grid%20preview%20from%20curves.png?raw=true)   \r\n\r\nSo what does that grid tell us? How would we know if it's a bad grid from bad curves? It just takes a little practice. The biggest problem is if the grid crosses itself, then the surface could double back on itself. The next problem is if one part of the grid is stretched out and almost pinches into a point. This will make FreeCAD's nurbs tesselation routine go crazy, lock up the program for a long time, and produce an ugly surface, if it makes it at all.\r\n\r\nIn the picture, on the left, you can see that all the 'squares' are roughly the same size, and the angles between lines are never less than 70 degrees or so. This is a reasonable grid.\r\n\r\nOn the right side, for the three curve grid, you can see a sliver of a triangle, this is not very good. This was my first try at a NURBS triangle, and it is not ideal. I have a very good idea how to fix it, and now that i have incorporated the curve weights into the surfaces, i can implement it. Soon it will be much better. An imperfect triangle surface now is better than than a perfect triangle surface later, so i included it in the first release.   \r\n--link placeholder to talk about degenerate NURBS patches\r\n\r\nMany times, a surface will look good when created, but when we set the display to shaded and hide the edge, the seam between two surfaces looks just absolutely awful. Here is a very crappy 'loft with rails'    \r\n\r\n![crappy loft with rails](https://github.com/edwardvmills/NURBSlib_EVM/blob/master/site_stuff/current_state/loft%20with%20rails%20-%20very%20crude.png?raw=true)   \r\n![G1 is not enough](https://github.com/edwardvmills/NURBSlib_EVM/blob/master/site_stuff/current_state/lofting%20with%20rails%20-%20Bezier%20G1%20is%20not%20enough.png?raw=true)\r\n\r\nThis is why G1 (tangency matching) is not enough. Using bezier curves/surfaces, direct G2 matching is obtained at the expense of tangent control, so that's just useless.   \r\n--link placeholder to talk about bezier and G2   \r\n\r\nHere is what i mean: in the picture below, i have massaged bezier surfaces to obtain G2 (curvature continuity) to a flat plate, but now i can _only control the position of the bottom curved edge_. I can make touch another edge, but i can't match tangents.   \r\n\r\n![G2 bezier](https://github.com/edwardvmills/NURBSlib_EVM/blob/master/site_stuff/current_state/Bezier%20G2%20transition.png?raw=true)\r\n\r\nEven maintaining G1 is way harder than it _seems_ it ought to be.   \r\n--link placeholder to go over the rules for curve making to obtain G1 across seams.   \r\n\r\nIn theory, we could set up a nonlinear solver that plays around with tangents and weights to seek G2, but this may not work. Even if it did, we would never have local control. Any change in any part would mean modifying everything everywhere. \r\n\r\nSo this is about as far as the bezier formulation of NURBS will get us. We can fill a few holes, and join a small number of surfaces if we are extremely careful. Time to break away from bezier! Let's keep the idea of control with endpoints and tangents, and toss away the rest.\r\n\r\n### Tutorials on the way: \r\n  \r\n-the 4 point bezier curve, for when the types of sketches shown above just aren't enough.   \r\n\r\n-the 6 point cubic NURBS. Now we can match curvature, and more, independently at each curve endpoint.  \r\n\r\n-working in bezier and converting to 6 point cubic NURBS   \r\n\r\n-the surface made from groups of 6 point cubic NURBS.   \r\n![G2 66 surfaces](https://github.com/edwardvmills/NURBSlib_EVM/blob/master/site_stuff/current_state/G2%20join%2066%20surfaces%2009.png?raw=true)\r\n\r\n-'growing' two surfaces on one side of a single surface: local refinement within a non singular NURBS topology   \r\n\r\n-the sketch placer tool to put nodes wherever you want them.   \r\n\r\n-the sketch based curvature prediction tool (very incomplete)\r\n\r\n-query curve type\r\n",
  "google": "",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}